#!/bin/bash

<% unless @venv_dir.nil? or @venv_dir.empty? %>
source <%= File.join(@venv_dir, "bin/activate") %>
<% end %>
<% unless @ION_CONFIGURATION_SECTION.nil? or @ION_CONFIGURATION_SECTION.empty? %>
export ION_CONFIGURATION_SECTION=<%= @ION_CONFIGURATION_SECTION %>
<% end %>

export LAUNCHED_VIA_RECIPE=yes

export PYTHON_EGG_CACHE=~/.<%=@service%>

<% unless @logging_config.nil? or @logging_config.empty? %>
export ION_ALTERNATE_LOGGING_CONF=<%= @logging_config %>
<% end %>

<% unless @logging_token.nil? or @logging_token.empty? %>
export LOGGLY_KEY=<%= @logging_token %>
<% end %>

APP_BIN=<%= @app_dir %>/bin
if [ -d $APP_BIN ]; then
  export PATH="$APP_BIN:$PATH"
fi
cd <%= @app_dir %>

exec <%=@service %> <%=@service_config %> <% if @background_process %>&<% end %>
